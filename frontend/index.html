<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Transfer Predictor</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        input[type="text"] { width: 300px; padding: 8px; }
        ul { list-style: none; padding: 0; margin: 0; border: 1px solid #ccc; max-height: 200px; overflow-y: auto; width: 320px; }
        li { padding: 8px; cursor: pointer; background: white; }
        li:hover { background: #f0f0f0; }
        button { margin-top: 10px; padding: 10px 20px; font-weight: bold; }
        pre { margin-top: 20px; background: #f8f8f8; padding: 15px; border: 1px solid #ccc; }
    </style>
</head>
<body>

<h1>⚽ Predict Transfer</h1>

<label for="search">Search Player:</label><br>
<input type="text" id="search" placeholder="e.g., Mbappé" oninput="buscarJogador()">
<ul id="suggestions"></ul>

<button onclick="preverTransferencia()">Predict</button>

<pre id="resultado"></pre>

<script>
    let selectedPlayerId = null;
    let jogadores = [];

    async function buscarJogador() {
        const query = document.getElementById("search").value;
        if (!query) {
            document.getElementById("suggestions").innerHTML = "";
            return;
        }

        const resposta = await fetch(`/search_player?name=${encodeURIComponent(query)}`);
        jogadores = await resposta.json();

        const lista = document.getElementById("suggestions");
        lista.innerHTML = "";

        jogadores.forEach(jogador => {
            const item = document.createElement("li");
            item.textContent = `${jogador.name} (${jogador.age || "?"} yrs) - ${jogador.current_club}`;
            item.onclick = () => {
                document.getElementById("search").value = jogador.name;
                selectedPlayerId = jogador.player_id;  // pega o player_id correto
                lista.innerHTML = "";
            };
            lista.appendChild(item);
        });
    }

    async function preverTransferencia() {
        if (selectedPlayerId === null) {
            alert("Please select a player from the list.");
            return;
        }

        const resposta = await fetch("/predict_transfer", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ player_id: selectedPlayerId })
        });

        const dados = await resposta.json();

        document.getElementById("resultado").textContent = JSON.stringify(dados, null, 2);
    }
</script>

</body>
</html>
